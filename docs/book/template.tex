\documentclass[11pt,a4paper,oneside]{book}

% --- Geometry and Typography (Base Packages) ---
\setcounter{secnumdepth}{3} % enable section numbering down to subsubsections
\usepackage[margin=1.2in,top=1.2in,bottom=1.2in]{geometry}
\usepackage{fontspec}
\setmainfont{Helvetica Neue} % Clean sans-serif main font
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}

% --- Headers and Footers (Base Packages) ---
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{} % Clear all headers and footers
\renewcommand{\headrulewidth}{0.4pt} % Re-enable the header line
\fancyhead[R]{\small\slshape\nouppercase{\leftmark}} % Place the chapter name in the top right header
\cfoot{\thepage} % Place the page number in the center of the footer

% Redefine plain style (used by chapter start pages) to also have no header and centered footer
\fancypagestyle{plain}{
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \cfoot{\thepage}
}

% --- Colors and Styling (Base Packages) ---
\usepackage{xcolor}
\definecolor{linkcol}{rgb}{0.0,0.4,0.7}
\definecolor{quoteborder}{rgb}{0.5,0.5,0.5}

% --- Section Formatting ---
\makeatletter
% By default, LaTeX puts \quad between the section number and the title text.
% This overrides that behavior to just put a single space or enskip.
\renewcommand{\@seccntformat}[1]{\csname the#1\endcsname\enskip}
\makeatother

% --- Blockquotes / Hacker Challenges ---
\usepackage{framed}
\renewenvironment{quote}
  {\def\FrameCommand{\textcolor{quoteborder}{\vrule width 3pt} \hspace{12pt}}%
   \MakeFramed {\advance\hsize-\width \FrameRestore}}
  {\endMakeFramed}

% --- Images and Figures (Base Packages) ---
\usepackage{graphicx}
\usepackage{float}
\usepackage[font={small,it},labelfont=bf,skip=6pt]{caption}

% Adjust spacing around figures
\setlength{\floatsep}{16pt plus 2pt minus 2pt}
\setlength{\textfloatsep}{24pt plus 4pt minus 4pt}
\setlength{\intextsep}{24pt plus 4pt minus 4pt}
\raggedbottom
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>0.8\linewidth0.8\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>0.45\textheight0.45\textheight\else\Gin@nat@height\fi}
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{0.45\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{0.8\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% --- Tables (Required by Pandoc) ---
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}

% --- Code Blocks (Required by Pandoc) ---
$highlighting-macros$
\fvset{fontsize=\small, xleftmargin=1.5em}

% --- Math (Base Packages) ---
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{unicode-math} % For better emoji/unicode handling if needed

% --- Links (Base Packages) ---
\usepackage[colorlinks=true,linkcolor=linkcol,urlcolor=linkcol,citecolor=linkcol]{hyperref}

% --- Pandoc Required Things ---
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\begin{document}

$body$

\end{document}
